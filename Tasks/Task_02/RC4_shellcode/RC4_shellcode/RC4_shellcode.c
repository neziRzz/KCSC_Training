#include <Windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

unsigned char rc4_shellcode[] =
{
0xfe, 0x20, 0x47, 0x2a, 0x47, 0xab, 0xa9, 0xab, 0xab, 0xf8, 0x20,
0xf6, 0xbb, 0xfd, 0x20, 0xde, 0xbf, 0xfc, 0x98, 0x54, 0x98,
0x62, 0x20, 0x6a, 0x23, 0x27, 0xa6, 0xab, 0x54, 0x54, 0x54,
0x32, 0x5c, 0x55, 0x21, 0xaf, 0xb1, 0x23, 0x2f, 0xa6, 0xab,
0x55, 0x54, 0x54, 0xea, 0x2a, 0x52, 0xab, 0xaa, 0xab, 0xab,
0xd7, 0x4a, 0x98, 0x5d, 0x98, 0x70, 0xa4, 0xb4, 0x2b, 0xab,
0xab, 0xab, 0xab, 0x21, 0x3f, 0x9e, 0xab, 0x54, 0x54, 0x54,
0xa4, 0x1d, 0x2f, 0x9e, 0xab, 0x55, 0x54, 0x54, 0xa8, 0x53,
0xa4, 0x1d, 0x61, 0xa8, 0x52, 0x2a, 0x4c, 0x54, 0xab, 0xab,
0x2b, 0xd2, 0xa3, 0xe4, 0x2a, 0x64, 0xab, 0x54, 0x54, 0x54,
0xec, 0x21, 0x2f, 0x96, 0xab, 0x54, 0x54, 0x54, 0x23, 0x3f,
0x96, 0xab, 0x54, 0x54, 0x54, 0x23, 0x2f, 0x9e, 0xab, 0x54,
0x54, 0x54, 0xed, 0x2a, 0x55, 0xab, 0xaa, 0xab, 0xab, 0xd7,
0x17, 0x20, 0xd6, 0xa7, 0x98, 0x5d, 0x2e, 0x54, 0xd5, 0xc5,
0x20, 0xfe, 0xb3, 0x82, 0xfe, 0xa3, 0xe8, 0x2a, 0x48, 0x54,
0xab, 0xab, 0x2b, 0xd2, 0xa3, 0xe0, 0x2a, 0x60, 0xab, 0x54,
0x54, 0x54, 0xe8, 0x21, 0x27, 0xb6, 0xab, 0x54, 0x54, 0x54,
0xa4, 0x1d, 0x6a, 0xa8, 0x5b, 0x2a, 0x4d, 0x54, 0xab, 0xab,
0x2b, 0xd2, 0xa3, 0xe5, 0x2a, 0x65, 0xab, 0x54, 0x54, 0x54,
0xed, 0x21, 0x2f, 0x9e, 0xab, 0x54, 0x54, 0x54, 0x23, 0x27,
0x9e, 0xab, 0x54, 0x54, 0x54, 0x23, 0x2f, 0xb6, 0xab, 0x54,
0x54, 0x54, 0xa4, 0x1d, 0x27, 0x9e, 0xab, 0x54, 0x54, 0x54,
0xa4, 0x1d, 0x6b, 0xa8, 0x63, 0xa4, 0x1d, 0x6a, 0x20, 0xe6,
0xa3, 0xa4, 0x1d, 0x2f, 0xae, 0xab, 0x54, 0x54, 0x54, 0x99,
0xaf, 0xba, 0x23, 0xa9, 0xe9, 0x28, 0x44, 0xaa, 0xde, 0x33,
0xf4, 0xf5, 0xf0, 0x20, 0x4e, 0xf6, 0x68
};

size_t j_strlen(unsigned char* a) {
    return strlen((char*)a);
}


int main() {

    unsigned char key[256];
    unsigned char data[256];
    unsigned char result[256];
    char* alloc_mem = NULL;
    int placeholder;
    

    printf("Enter key: ");
    if (fgets((char*)key, sizeof(key), stdin) != NULL) {
        // Remove newline character from the key
        key[strcspn((char*)key, "\n")] = '\0';
    }


    printf("Enter data to encrypt: ");
    if (fgets((char*)data, sizeof(data), stdin) != NULL) {
        // Remove newline character from the data
        data[strcspn((char*)data, "\n")] = '\0';
    }
    int keyLen = j_strlen((char*)key);
    int dataLen = j_strlen((char*)data);
    alloc_mem = VirtualAlloc(NULL, sizeof(rc4_shellcode), (MEM_COMMIT | MEM_RESERVE), PAGE_EXECUTE_READWRITE);
    for (int i = 0; i < sizeof(rc4_shellcode); i++)
    {
        alloc_mem[i] = rc4_shellcode[i] ^ 0xAB;
    }
    placeholder = ((int(_cdecl*)(unsigned char*, int, unsigned char*, int, unsigned char*))(void*)alloc_mem)(data, dataLen, key, keyLen, result);
    VirtualFree(alloc_mem, sizeof(rc4_shellcode), MEM_RELEASE);
    printf("Encrypted data: ");
    for (int i = 0; i < dataLen; i++) {
        printf("%02X ", result[i]);
    }
    printf("\n");

    return 0;
}
